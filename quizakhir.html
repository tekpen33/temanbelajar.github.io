<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Evaluasi Akhir AI</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 30px;
}

.quiz-box {
  max-width: 800px;
  margin: auto;
  background: #ffffff;
  padding: 30px;
  border-radius: 12px;
}

h2 {
  text-align: center;
  margin-bottom: 25px;
}

/* INPUT STYLE (SEPERTI GAMBAR) */
.form-group {
  margin-bottom: 18px;
}

.form-group label {
  font-weight: bold;
  margin-bottom: 6px;
  display: block;
}

.form-group input {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid #cbd5e1;
  font-size: 15px;
}

.form-group input:focus {
  outline: none;
  border-color: #2563eb;
}

/* SOAL */
.question {
  margin-bottom: 22px;
}

.question p {
  font-weight: bold;
}

.question label {
  display: block;
  margin: 6px 0;
  cursor: pointer;
}

/* BUTTON */
button {
  margin-top: 20px;
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 10px;
  background: #2563eb;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

button:hover {
  background: #1e40af;
}

/* RESULT */
.result {
  margin-top: 20px;
  padding: 16px;
  border-radius: 10px;
  display: none;
  font-weight: bold;
}

.success {
  background: #dcfce7;
  color: #166534;
}

.fail {
  background: #fee2e2;
  color: #991b1b;
}
</style>
</head>

<body>

<div class="quiz-box">
<h2>Evaluasi Akhir Materi AI</h2>

<form id="quizForm">

  <!-- DATA SISWA -->
  <div class="form-group">
    <label>Nama Lengkap</label>
    <input type="text" id="nama" placeholder="Masukkan nama" required>
  </div>

  <div class="form-group">
    <label>NISN</label>
    <input type="text" id="nisn" placeholder="Masukkan NISN" required>
  </div>

</form>

<div id="result" class="result"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAcB4nf6LpWl4_lYdWjiSJhVPA_Zd619QI",
  authDomain: "teman-belajar-476bf.firebaseapp.com",
  projectId: "teman-belajar-476bf",
  storageBucket: "teman-belajar-476bf.firebasestorage.app",
  messagingSenderId: "78220122476",
  appId: "1:78220122476:web:318a5afc32de2dcc6a3b49"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* SOAL EVALUASI */
const questions = [
 { q:"AI yang hanya dapat melakukan satu tugas tertentu disebut …",
   o:["General AI","Superintelligence","Narrow AI","Self-Awareness"], a:2 },

 { q:"Contoh penerapan Narrow AI adalah …",
   o:["Berpikir seperti manusia","Memahami emosi","Rekomendasi lagu Spotify","Menguasai semua bidang"], a:2 },

 { q:"AI dengan kemampuan setara manusia disebut …",
   o:["Narrow AI","Reactive Machine","General AI","Superintelligence"], a:2 },

 { q:"Superintelligence adalah AI yang …",
   o:["Digunakan sehari-hari","Satu tugas","Lebih pintar dari manusia","Tanpa memori"], a:2 },

 { q:"AI tanpa memori disebut …",
   o:["Limited Memory","Theory of Mind","Reactive Machines","Self-Awareness"], a:2 },

 { q:"AI yang belajar dari pengalaman jangka pendek disebut …",
   o:["Reactive Machines","Limited Memory","Superintelligence","General AI"], a:1 },

 { q:"AI yang memahami emosi manusia disebut …",
   o:["Narrow AI","Theory of Mind","Limited Memory","Self-Awareness"], a:1 },

 { q:"Contoh AI generatif adalah …",
   o:["Google Maps","Kamera HP","ChatGPT","Kalkulator"], a:2 },

 { q:"Prompt Engineering adalah …",
   o:["Memperbaiki mesin AI","Membuat robot","Memberi perintah tepat ke AI","Bahasa pemrograman"], a:2 },

 { q:"Sikap bijak menggunakan AI adalah …",
   o:["Menyebarkan hoaks","Mengandalkan AI sepenuhnya","Menggunakan secara bertanggung jawab","Membiarkan AI memutuskan semua"], a:2 }
];

const form = document.getElementById("quizForm");
const resultBox = document.getElementById("result");

/* RENDER SOAL */
questions.forEach((q,i)=>{
  let html = `<div class="question"><p>${i+1}. ${q.q}</p>`;
  q.o.forEach((opt,idx)=>{
    html += `
    <label>
      <input type="radio" name="q${i}" value="${idx}"> ${opt}
    </label>`;
  });
  html += `</div>`;
  form.innerHTML += html;
});

form.innerHTML += `<button type="submit">Kirim Jawaban</button>`;

/* AUTH CHECK */
let currentUser = null;
onAuthStateChanged(auth, user=>{
  if(!user){
    alert("Silakan login terlebih dahulu");
    location.href="index.html";
  }
  currentUser = user;
});

/* SUBMIT */
form.addEventListener("submit", async(e)=>{
  e.preventDefault();

  const nama = document.getElementById("nama").value.trim();
  const nisn = document.getElementById("nisn").value.trim();

  if(!nama || !nisn){
    alert("Nama dan NISN wajib diisi");
    return;
  }

  let score = 0;
  for(let i=0;i<questions.length;i++){
    const pilih = form.querySelector(`input[name="q${i}"]:checked`);
    if(!pilih){
      alert("Semua soal wajib dijawab");
      return;
    }
    if(parseInt(pilih.value) === questions[i].a) score++;
  }

  const nilai = Math.round((score/questions.length)*100);
  const ref = doc(db,"nilai_evaluasi",nisn);

  const cek = await getDoc(ref);
  if(cek.exists()){
    alert("NISN ini sudah mengerjakan evaluasi");
    return;
  }

  await setDoc(ref,{
    nama,
    nisn,
    nilai,
    statusLulus: nilai>=75 ? "LULUS":"TIDAK LULUS",
    createdAt: serverTimestamp()
  });

  resultBox.style.display="block";
  resultBox.className = nilai>=75 ? "result success":"result fail";
  resultBox.innerHTML = nilai>=75
    ? `✅ Selamat ${nama}, Anda LULUS dengan nilai ${nilai}`
    : `❌ Nilai Anda ${nilai}. Silakan pelajari kembali materi.`;
});
</script>

</body>
</html>
